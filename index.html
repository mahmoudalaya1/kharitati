<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ø¹ÙŠØ§ - Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root { --blue: #4285F4; --red: #EA4335; --gray: #5f6368; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; font-family: sans-serif; overflow: hidden; }
        
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-ui { 
            position: fixed; top: 12px; width: 90%; left: 5%; z-index: 2000; 
            background: white; border-radius: 24px; display: flex; align-items: center;
            padding: 8px 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .top-ui input { border: none; flex: 1; padding: 8px; font-size: 16px; outline: none; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-btns { position: fixed; right: 15px; bottom: 140px; z-index: 2000; display: flex; flex-direction: column; gap: 15px; }
        .fab {
            width: 50px; height: 50px; background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3); color: var(--gray); cursor: pointer;
        }
        .btn-go { background: var(--blue); color: white; }

        /* Ù„ÙˆØ­Ø© "Ø§Ø³ØªÙƒØ´Ù Ø­ÙˆÙ„Ùƒ" Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„ØªØ®ØªÙÙŠ */
        .bottom-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            z-index: 2100; border-radius: 20px 20px 0 0; padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0); /* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Ø¸Ø§Ù‡Ø±Ø© */
        }

        /* Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø­Ø±ÙŠ Ù„Ù„Ø¥Ø®ÙØ§Ø¡ */
        .bottom-sheet.hidden-panel {
            transform: translateY(85%); /* ØªØªØ±Ùƒ ÙÙ‚Ø· Ø§Ù„Ø­Ø§ÙØ© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø¸Ø§Ù‡Ø±Ø© */
        }

        .sheet-handle { width: 40px; height: 5px; background: #e0e0e0; border-radius: 5px; margin: 0 auto 15px; cursor: pointer; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn-opt { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 10px; background: white; cursor: pointer; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="top-ui">
    <i class="fas fa-bars"></i>
    <input type="text" id="searchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« Ù‡Ù†Ø§ (Ù…Ø·Ø¹Ù…ØŒ ÙˆÙ‚ÙˆØ¯...)">
    <i class="fas fa-microphone" style="color: var(--blue);"></i>
</div>

<div class="side-btns">
    <div class="fab" onclick="changeMapLayer()"><i class="fas fa-layer-group"></i></div>
    <div class="fab" onclick="getMyLocation()"><i class="fas fa-location-crosshairs"></i></div>
    <div class="fab btn-go" onclick="startNavigation()"><i class="fas fa-directions"></i></div>
</div>

<div class="bottom-sheet" id="mySheet">
    <div class="sheet-handle" onclick="toggleSheet()"></div>
    <h3 style="margin:0">Ø§Ø³ØªÙƒØ´Ù Ø­ÙˆÙ„Ùƒ</h3>
    <p style="color:#70757a; font-size: 14px;">Ø­Ø¯Ø¯ ÙˆØ¬Ù‡Ø© Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø­ÙŠØ©</p>
    <div class="btn-group">
        <button class="btn-opt" onclick="findNearby('gas')">â›½ Ù…Ø­Ø·Ø©</button>
        <button class="btn-opt" onclick="findNearby('food')">ğŸ´ Ù…Ø·Ø¹Ù…</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    var map = L.map('map', { zoomControl: false }).setView([24.7136, 46.6753], 13);
    var streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var satLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    // 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© (Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„Ù„Ù…Ø´ÙƒÙ„Ø©)
    const sheet = document.getElementById('mySheet');
    
    function toggleSheet() {
        sheet.classList.toggle('hidden-panel');
    }

    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ù„Ù…Ø³ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ÙØªØ­ Ø§Ù„Ø±Ø¤ÙŠØ©
    map.on('click', function() {
        sheet.classList.add('hidden-panel');
    });

    // 3. Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø·Ø¨Ù‚Ø§Øª
    var userMarker;
    function getMyLocation() {
        map.locate({setView: true, maxZoom: 16});
        sheet.classList.add('hidden-panel'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø© Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    }

    map.on('locationfound', function(e) {
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.circleMarker(e.latlng, {
            radius: 8, color: 'white', fillColor: '#4285F4', fillOpacity: 1, weight: 3
        }).addTo(map);
    });

    function changeMapLayer() {
        if (map.hasLayer(streetLayer)) {
            map.removeLayer(streetLayer);
            satLayer.addTo(map);
        } else {
            map.removeLayer(satLayer);
            streetLayer.addTo(map);
        }
    }

    // 4. Ø§Ù„Ø¨Ø­Ø« (ØªÙ… ØªØµØ­ÙŠØ­Ù‡)
    const sInput = document.getElementById('searchInput');
    sInput.addEventListener('keypress', async (e) => {
        if (e.key === 'Enter') {
            const query = sInput.value;
            const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=1`);
            const results = await response.json();
            if(results.length > 0) {
                const p = results[0];
                map.setView([p.lat, p.lon], 16);
                L.marker([p.lat, p.lon]).addTo(map).bindPopup(p.display_name).openPopup();
                sheet.classList.add('hidden-panel');
            }
        }
    });

    async function findNearby(type) {
        alert("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† " + type);
        sheet.classList.add('hidden-panel');
    }

    function startNavigation() {
        alert("Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø­ÙŠØ©...");
    }

    window.onload = function() { getMyLocation(); };
</script>

</body>
</html>


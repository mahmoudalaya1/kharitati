<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Geocoder -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css">
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<!-- Routing -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
html,body{margin:0;height:100%;font-family:Arial}
#map{height:100vh}

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
#panel{
  position:absolute;
  top:15px;
  left:15px;
  background:#fff;
  padding:12px;
  border-radius:12px;
  width:260px;
  z-index:1000;
  box-shadow:0 4px 12px rgba(0,0,0,.25);
}

#panel h3{margin:0 0 8px 0}

#panel button{
  width:100%;
  padding:9px;
  margin-top:6px;
  border:none;
  border-radius:8px;
  background:#1976d2;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}

#panel button.gray{background:#555}

/* Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ */
#accountBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  width:56px;
  height:56px;
  border-radius:50%;
  border:none;
  background:#1976d2;
  color:#fff;
  font-size:26px;
  cursor:pointer;
  z-index:1200;
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ */
#loginBox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
}

#loginBox .box{
  background:#fff;
  padding:20px;
  width:280px;
  border-radius:12px;
  text-align:center;
}

#loginBox input{
  width:100%;
  padding:9px;
  margin-top:6px;
}

</style>
</head>

<body>

<div id="panel">
  <h3>ğŸš— Ø§Ù„Ù…Ù„Ø§Ø­Ø©</h3>
  <button onclick="useMyLocation()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ ÙƒÙ†Ù‚Ø·Ø© Ø¨Ø¯Ø§ÙŠØ©</button>
  <button onclick="selectStart()">Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
  <button onclick="selectEnd()">Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„</button>
  <button onclick="startRouting()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù„Ø§Ø­Ø©</button>
  <button class="gray" onclick="clearRoute()">Ù…Ø³Ø­ Ø§Ù„Ù…Ø³Ø§Ø±</button>
</div>

<button id="accountBtn" onclick="openLogin()">ğŸ‘¤</button>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ -->
<div id="loginBox">
  <div class="box">
    <h3>Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
    <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    <button class="gray" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    <button onclick="closeLogin()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<div id="map"></div>

<script>
/* Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map = L.map('map').setView([36.2021,37.1343],13);

L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {attribution:'Â© OpenStreetMap'}
).addTo(map);

/* Ø¨Ø­Ø« */
L.Control.geocoder({defaultMarkGeocode:true}).addTo(map);

/* Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù„Ø§Ø­Ø© */
let startPoint=null;
let endPoint=null;
let routing=null;
let selecting=null;

/* ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ */
function useMyLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    startPoint = L.latLng(pos.coords.latitude,pos.coords.longitude);
    map.setView(startPoint,15);
    L.marker(startPoint).addTo(map).bindPopup("Ù…ÙˆÙ‚Ø¹ÙŠ").openPopup();
  },()=>alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹"));
}

/* Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø§Ø· */
function selectStart(){
  selecting="start";
  alert("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©");
}
function selectEnd(){
  selecting="end";
  alert("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„");
}

map.on("click",e=>{
  if(selecting==="start"){
    startPoint=e.latlng;
    L.marker(startPoint).addTo(map).bindPopup("Ø¨Ø¯Ø§ÙŠØ©").openPopup();
  }
  if(selecting==="end"){
    endPoint=e.latlng;
    L.marker(endPoint).addTo(map).bindPopup("ÙˆØµÙˆÙ„").openPopup();
  }
  selecting=null;
});

/* Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø© */
function startRouting(){
  if(!startPoint||!endPoint)
    return alert("Ø­Ø¯Ø¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„");

  if(routing) map.removeControl(routing);

  routing = L.Routing.control({
    waypoints:[startPoint,endPoint],
    routeWhileDragging:false,
    show:false,
    addWaypoints:false
  }).addTo(map);
}

/* Ù…Ø³Ø­ */
function clearRoute(){
  if(routing) map.removeControl(routing);
  routing=null;
  startPoint=null;
  endPoint=null;
  map.eachLayer(l=>{
    if(l instanceof L.Marker) map.removeLayer(l);
  });
}

/* Ø­Ø³Ø§Ø¨ (ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø­Ù„ÙŠ) */
function login(){
  if(!email.value||!password.value) return alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„");
  localStorage.setItem("user",email.value);
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
  closeLogin();
}
function register(){login();}
function logout(){
  localStorage.removeItem("user");
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
}
function openLogin(){
  loginBox.style.display="flex";
}
function closeLogin(){
  loginBox.style.display="none";
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;font-family:Arial}
#map{height:100vh}

/* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
#loginBox{
  position:fixed;
  inset:0;
  background:#f5f5f5;
  z-index:20000;
  display:flex;
  align-items:center;
  justify-content:center;
}
#loginBox .box{
  background:white;
  padding:20px;
  border-radius:10px;
  width:300px;
  text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
}
#loginBox input{
  width:100%;
  padding:8px;
  margin-bottom:8px;
}

/* Ø£Ø²Ø±Ø§Ø± */
.btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-bottom:6px;
}
.btn-login{background:#2196f3;color:white}
.btn-register{background:#4caf50;color:white}
.btn-google{background:#4285F4;color:white}

/* Ø§Ù„Ø¨Ø­Ø« */
.search-bar{
  position:fixed;
  top:10px;
  left:10px;
  background:white;
  padding:8px;
  border-radius:25px;
  display:flex;
  gap:6px;
  z-index:5000;
  box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.search-bar input{
  border:none;
  outline:none;
  width:180px;
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox">
  <div class="box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>

    <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

    <button class="btn btn-login" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <button class="btn btn-register" onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>

    <hr>

    <!-- Google Login (Ø®Ø§Ø±Ø¬ÙŠ ÙÙ‚Ø·) -->
    <button class="btn btn-google" onclick="openGoogleLogin()">
      ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
    </button>
  </div>
</div>

<!-- Ø§Ù„Ø¨Ø­Ø« -->
<div class="search-bar">
  ğŸ”
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <button onclick="doSearch()">OK</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase Email Login -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
  authDomain: "kharitati-5cb37.firebaseapp.com",
  projectId: "kharitati-5cb37"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ */
window.register = () => {
  createUserWithEmailAndPassword(auth, email.value, password.value)
    .then(()=>alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨"))
    .catch(e=>alert(e.message));
};

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
window.login = () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
    .catch(e=>alert(e.message));
};

/* Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.style.display="none";
  }
});
</script>

<script>
/* Google Login Ø®Ø§Ø±Ø¬ÙŠ */
function openGoogleLogin(){
  window.open(
    "https://mahmoudalaya1.github.io/kharitati/",
    "_system"
  );
}

/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map=L.map("map").setView([33.5,36.3],6);
let marker=null;

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
.addTo(map);

function setMarker(lat,lon,text){
  if(marker) map.removeLayer(marker);
  marker=L.marker([lat,lon]).addTo(map).bindPopup(text).openPopup();
}

/* Ø§Ù„Ø¨Ø­Ø« */
function doSearch(){
  if(!search.value) return;
  fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(search.value)}`)
  .then(r=>r.json())
  .then(d=>{
    if(!d.length){alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ±");return;}
    setMarker(d[0].lat,d[0].lon,d[0].display_name);
    map.setView([d[0].lat,d[0].lon],13);
  });
}

/* Enter Ù„Ù„Ø¨Ø­Ø« */
search.addEventListener("keydown",e=>{
  if(e.key==="Enter") doSearch();
});
</script>

</body>
</html>

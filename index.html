<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>My Maps</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
html,body,#map{height:100%;margin:0;font-family:Arial}
#map{z-index:1}

/* ===== Search Bar ===== */
#searchBar{
  position:absolute;top:12px;left:50%;
  transform:translateX(-50%);
  background:white;
  width:92%;max-width:460px;
  padding:12px 16px;
  border-radius:30px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  z-index:999
}
#searchBar input{
  border:none;width:100%;
  font-size:16px;outline:none
}
#results{
  margin-top:8px;font-size:14px
}

/* ===== Floating Buttons ===== */
#float{
  position:absolute;right:12px;bottom:140px;
  display:flex;flex-direction:column;gap:10px;
  z-index:999
}
#float button{
  width:52px;height:52px;
  border:none;border-radius:50%;
  background:white;font-size:22px;
  box-shadow:0 3px 10px rgba(0,0,0,.3)
}

/* ===== Bottom Sheet ===== */
#sheet{
  position:absolute;bottom:0;left:0;
  width:100%;background:white;
  border-radius:22px 22px 0 0;
  box-shadow:0 -4px 20px rgba(0,0,0,.3);
  padding:16px;
  z-index:999
}
#sheet h3{margin:0 0 8px}
#sheet p{margin:0;font-size:14px;color:#444}

/* ===== Arrow ===== */
#arrow{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  font-size:42px;z-index:998
}
</style>
</head>

<body>

<div id="map"></div>
<div id="arrow">â¬†ï¸</div>

<!-- Search -->
<div id="searchBar">
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <div id="results"></div>
</div>

<!-- Floating -->
<div id="float">
  <button onclick="locate()">ğŸ“</button>
  <button onclick="toggleDark()">ğŸŒ™</button>
  <button onclick="startNav()">â–¶ï¸</button>
</div>

<!-- Bottom Sheet -->
<div id="sheet">
  <h3 id="title">Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ù„Ø§Ø­Ø©</h3>
  <p id="info">Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø© Ù„Ù„Ø¨Ø¯Ø¡</p>
</div>

<script>
/* ===== MAP ===== */
const map=L.map("map",{zoomControl:false}).setView([36.2,37.13],15);
const normal=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
const dark=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png");

let darkOn=false;
function toggleDark(){
  darkOn?map.removeLayer(dark):map.addLayer(dark);
  darkOn=!darkOn;
}

/* ===== LOCATION ===== */
let start=null,end=null,route=null,marker=null;
navigator.geolocation.watchPosition(p=>{
  start=L.latLng(p.coords.latitude,p.coords.longitude);
  if(!marker) marker=L.marker(start).addTo(map);
  else marker.setLatLng(start);
},{},{enableHighAccuracy:true});

function locate(){
  if(start) map.setView(start,17,{animate:true});
}

/* ===== SEARCH ===== */
const search=document.getElementById("search");
const results=document.getElementById("results");

search.oninput=()=>{
  if(search.value.length<3){results.innerHTML="";return;}
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${search.value}`)
  .then(r=>r.json()).then(d=>{
    results.innerHTML="";
    d.slice(0,5).forEach(p=>{
      const div=document.createElement("div");
      div.innerText=p.display_name;
      div.onclick=()=>{
        end=L.latLng(p.lat,p.lon);
        map.setView(end,15);
        results.innerHTML="";
        document.getElementById("title").innerText=p.display_name;
      };
      results.appendChild(div);
    });
  });
};

/* ===== NAVIGATION ===== */
function startNav(){
  if(!start||!end){alert("Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø©");return;}
  if(route) map.removeControl(route);
  route=L.Routing.control({
    waypoints:[start,end],
    router:L.Routing.osrmv1(),
    addWaypoints:false,
    show:false
  })
  .on("routesfound",e=>{
    const r=e.routes[0];
    document.getElementById("info").innerText=
      `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ${(r.summary.totalDistance/1000).toFixed(1)} ÙƒÙ… â€“ ${(r.summary.totalTime/60).toFixed(0)} Ø¯Ù‚ÙŠÙ‚Ø©`;
  })
  .addTo(map);
}

/* ===== ARROW ===== */
window.addEventListener("deviceorientation",e=>{
  if(e.alpha)
    document.getElementById("arrow").style.transform=
      `translate(-50%,-50%) rotate(${e.alpha}deg)`;
});
</script>

</body>
</html>

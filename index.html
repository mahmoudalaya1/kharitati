<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html,body{margin:0;height:100%;font-family:Arial}
#map{height:100%}

/* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
#topBar{
  position:fixed;top:0;left:0;right:0;height:56px;
  background:#fff;display:flex;align-items:center;
  gap:8px;padding:0 10px;box-shadow:0 2px 8px rgba(0,0,0,.15);
  z-index:1200
}
#title{font-weight:bold;font-size:18px}
#search{
  flex:1;border:1px solid #ddd;border-radius:10px;
  padding:8px 10px;font-size:14px
}
#searchBtn{
  border:none;border-radius:10px;padding:8px 12px;
  background:#2d7cff;color:#fff;cursor:pointer
}

/* Ø£Ø²Ø±Ø§Ø± Floating */
.map-btn{
  position:fixed;right:16px;width:48px;height:48px;
  border-radius:14px;background:#fff;border:none;
  font-size:20px;box-shadow:0 8px 20px rgba(0,0,0,.25);
  cursor:pointer;z-index:1100
}
#locate{top:70px}
#zoomIn{top:130px}
#zoomOut{top:190px}
#theme{top:250px}

#navBtn{
  bottom:24px;right:50%;transform:translateX(50%);
  width:64px;height:64px;border-radius:50%;
  background:#2d7cff;color:#fff;font-size:26px
}

/* Ø³Ù‡Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡ */
#compass{
  position:fixed;left:16px;bottom:24px;
  width:52px;height:52px;border-radius:50%;
  background:#fff;display:flex;align-items:center;
  justify-content:center;font-size:22px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
  z-index:1100
}
#arrow{transition:transform .2s linear}

/* ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ */
.dark #topBar{background:#1e1e1e;color:#fff}
.dark #search{background:#2b2b2b;color:#fff;border-color:#444}
.dark .map-btn{background:#1e1e1e;color:#fff}
</style>
</head>

<body>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
<div id="topBar">
  <div id="title">ğŸ—ºï¸ Ø®Ø±ÙŠØ·ØªÙŠ</div>
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†...">
  <button id="searchBtn">ğŸ”</button>
</div>

<!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<button id="locate" class="map-btn">ğŸ“</button>
<button id="zoomIn" class="map-btn">ï¼‹</button>
<button id="zoomOut" class="map-btn">ï¼</button>
<button id="theme" class="map-btn">ğŸŒ™</button>
<button id="navBtn" class="map-btn">ğŸ§­</button>

<div id="compass"><div id="arrow">â–²</div></div>
<div id="map"></div>

<script>
// ================== Ø§Ù„Ø®Ø±ÙŠØ·Ø© ==================
var map = L.map('map',{zoomControl:false}).setView([36.2021,37.1343],13);

// Tiles
var lightTiles = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
  {maxZoom:19,attribution:''}
).addTo(map);

var darkTiles = L.tileLayer(
  'https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png',
  {maxZoom:19,attribution:''}
);

var dark=false;

// ================== Ø£Ø²Ø±Ø§Ø± ==================
zoomIn.onclick=()=>map.zoomIn();
zoomOut.onclick=()=>map.zoomOut();

locate.onclick=()=>{
  map.locate({setView:true,maxZoom:16});
};

// ================== Ù…Ø¤Ø´Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ ==================
var userMarker;
map.on('locationfound',e=>{
  if(userMarker) map.removeLayer(userMarker);
  userMarker=L.circleMarker(e.latlng,{
    radius:8,color:'#2d7cff',
    fillColor:'#2d7cff',fillOpacity:1
  }).addTo(map).bindPopup("Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ");
});

// ================== Ø§Ù„Ø¨Ø­Ø« ==================
searchBtn.onclick=()=>{
  var q=search.value.trim();
  if(!q) return;
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d[0]) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù†");
      var lat=d[0].lat, lon=d[0].lon;
      map.setView([lat,lon],15);
      L.marker([lat,lon]).addTo(map)
        .bindPopup(d[0].display_name).openPopup();
    });
};

// ================== Ø§Ù„Ù…Ù„Ø§Ø­Ø© ==================
var routeLine=null;
navBtn.onclick=()=>{
  if(routeLine){map.removeLayer(routeLine);routeLine=null;return;}
  var route=[
    [36.2021,37.1343],
    [36.2055,37.1380],
    [36.2090,37.1425],
    [36.2130,37.1470]
  ];
  routeLine=L.polyline(route,{
    color:'#2d7cff',weight:6,lineCap:'round'
  }).addTo(map);
  map.fitBounds(routeLine.getBounds(),{padding:[50,50]});
};

// ================== Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ==================
theme.onclick=()=>{
  dark=!dark;
  document.body.classList.toggle('dark',dark);
  if(dark){
    map.removeLayer(lightTiles);
    darkTiles.addTo(map);
    theme.textContent='â˜€ï¸';
  }else{
    map.removeLayer(darkTiles);
    lightTiles.addTo(map);
    theme.textContent='ğŸŒ™';
  }
};

// ================== Ø§Ù„Ø¨ÙˆØµÙ„Ø© ==================
if(window.DeviceOrientationEvent){
  window.addEventListener('deviceorientation',e=>{
    if(e.alpha==null) return;
    document.getElementById('arrow')
      .style.transform=`rotate(${-e.alpha}deg)`;
  });
}
</script>

</body>
</html>

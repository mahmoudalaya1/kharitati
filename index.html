<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{margin:0;height:100%;font-family:Arial}
#map{height:100%}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ù…Ø«Ù„ Google */
.search-bar{
  position:fixed;
  top:12px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:480px;
  background:#fff;
  border-radius:30px;
  box-shadow:0 4px 12px rgba(0,0,0,.25);
  display:flex;
  align-items:center;
  padding:6px 12px;
  z-index:10000;
}
.search-bar input{
  flex:1;
  border:none;
  outline:none;
  font-size:15px;
  padding:8px;
}
.search-bar button{
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
}

/* Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø¦Ø±ÙŠØ© ÙŠÙ…ÙŠÙ† */
.fab{
  position:fixed;
  right:14px;
  bottom:90px;
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:10000;
}
.fab button{
  width:48px;
  height:48px;
  border-radius:50%;
  border:none;
  background:#fff;
  box-shadow:0 3px 10px rgba(0,0,0,.3);
  font-size:20px;
  cursor:pointer;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ */
.actions{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  z-index:10000;
}
.actions button{
  padding:10px 16px;
  border:none;
  border-radius:20px;
  color:#fff;
  font-size:14px;
  cursor:pointer;
}
.save{background:#4caf50}
.edit{background:#ff9800}
.del{background:#f44336}

/* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« */
.results{
  position:fixed;
  top:62px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:480px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.25);
  max-height:260px;
  overflow:auto;
  display:none;
  z-index:10000;
}
.results div{
  padding:10px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.results div:hover{background:#f5f5f5}
</style>
</head>

<body>

<div id="map"></div>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
<div class="search-bar">
  ğŸ”
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†ØŒ Ø´Ø§Ø±Ø¹ØŒ Ù…Ù†Ø·Ù‚Ø©">
  <button onclick="locateMe()">ğŸ“</button>
</div>

<div class="results" id="results"></div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø¬Ø§Ù†Ø¨ÙŠØ© -->
<div class="fab">
  <button onclick="map.zoomIn()">ï¼‹</button>
  <button onclick="map.zoomOut()">ï¼</button>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ -->
<div class="actions">
  <button class="save" onclick="savePlace()">â­ Ø­ÙØ¸</button>
  <button class="edit" onclick="editPlace()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
  <button class="del" onclick="deletePlace()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map = L.map('map').setView([33.5,36.3],6);

const normal = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
const satellite = L.tileLayer(
 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
);
const terrain = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png');

normal.addTo(map);

L.control.layers(
 {"ğŸ—ºï¸ Ø¹Ø§Ø¯ÙŠØ©":normal,"ğŸ›°ï¸ Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ":satellite,"ğŸ—» ØªØ¶Ø§Ø±ÙŠØ³":terrain},
 null,
 {position:'bottomleft'}
).addTo(map);

let marker=null, editMode=false;

/* ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© */
function setMarker(lat,lon,text){
 if(marker) map.removeLayer(marker);
 marker=L.marker([lat,lon]).addTo(map).bindPopup(text).openPopup();
}

/* Ø§Ù„Ø¨Ø­Ø« (Autocomplete Ù…Ø«Ù„ Google) */
let timer=null;
search.oninput=()=>{
 clearTimeout(timer);
 if(search.value.length<3){
   results.style.display="none";return;
 }
 timer=setTimeout(()=>{
  fetch(`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=6&q=${encodeURIComponent(search.value)}`)
  .then(r=>r.json())
  .then(d=>{
    results.innerHTML="";
    if(!d.length){results.style.display="none";return;}
    d.forEach(p=>{
      const div=document.createElement("div");
      div.innerText=p.display_name;
      div.onclick=()=>{
        setMarker(p.lat,p.lon,p.display_name);
        map.setView([p.lat,p.lon],16);
        results.style.display="none";
      };
      results.appendChild(div);
    });
    results.style.display="block";
  });
 },400);
};

/* Ù…ÙˆÙ‚Ø¹ÙŠ */
function locateMe(){
 navigator.geolocation.getCurrentPosition(p=>{
  setMarker(p.coords.latitude,p.coords.longitude,"ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ");
  map.setView([p.coords.latitude,p.coords.longitude],17);
 });
}

/* Ø£Ø¯ÙˆØ§Øª */
map.on('click',e=>{
 if(!editMode && marker) return;
 setMarker(e.latlng.lat,e.latlng.lng,"ğŸ“ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯");
 editMode=false;
});
function savePlace(){
 if(!marker) return alert("Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
 localStorage.setItem("saved",JSON.stringify(marker.getLatLng()));
 alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}
function editPlace(){
 if(!marker) return;
 editMode=true;
 alert("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…ÙƒØ§Ù† Ø¬Ø¯ÙŠØ¯");
}
function deletePlace(){
 if(marker){map.removeLayer(marker);marker=null;}
 localStorage.removeItem("saved");
}
</script>

</body>
</html>

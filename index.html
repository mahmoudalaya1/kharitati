<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
html,body{margin:0;height:100%;font-family:Arial}
#map{height:100%}

/* Ø´Ø§Ø´Ø© ØªØ±Ø­ÙŠØ¨ */
#welcome{
  position:fixed;inset:0;
  background:#1976d2;color:white;
  display:flex;align-items:center;justify-content:center;
  z-index:9999;text-align:center
}
#welcome button{
  padding:12px 20px;border:none;border-radius:30px;
  font-size:18px;background:white;color:#1976d2
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
#top{
  position:fixed;top:10px;left:50%;
  transform:translateX(-50%);
  width:92%;max-width:460px;
  background:white;border-radius:30px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  padding:10px;z-index:1000
}
#top input{border:none;width:100%;font-size:16px}

/* Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª */
#sug{background:white;border-radius:12px;display:none}

/* Ø£Ø²Ø±Ø§Ø± */
#btns{
  position:fixed;right:10px;top:90px;
  display:flex;flex-direction:column;gap:8px;
  z-index:1000
}
#btns button{
  border:none;border-radius:14px;
  padding:12px;font-size:18px;
  background:#1976d2;color:white
}

/* Ø³Ù‡Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡ */
#compass{
  position:fixed;bottom:20px;right:20px;
  font-size:32px
}
</style>
</head>

<body>

<div id="welcome">
  <div>
    <h1>ğŸ—ºï¸ Ø®Ø±ÙŠØ·ØªÙŠ</h1>
    <p>Ù…Ù„Ø§Ø­Ø© Ø°ÙƒÙŠØ© Ø¨Ø¯ÙˆÙ† Google</p>
    <button onclick="startApp()">Ø§Ø¨Ø¯Ø£</button>
  </div>
</div>

<div id="top">
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <div id="sug"></div>
</div>

<div id="btns">
  <button onclick="setMode('car')">ğŸš—</button>
  <button onclick="setMode('foot')">ğŸš¶â€â™‚ï¸</button>
  <button onclick="setMode('bike')">ğŸš´</button>
  <button onclick="toggleDark()">ğŸŒ™</button>
  <button onclick="savePlace()">â­</button>
  <button onclick="setHome()">ğŸ </button>
  <button onclick="goHome()">ğŸ¡</button>
  <button onclick="toggleTraffic()">ğŸš¦</button>
  <button onclick="share()">ğŸ“¤</button>
  <button onclick="clearRoute()">âŒ</button>
</div>

<div id="compass">ğŸ§­</div>
<div id="map"></div>

<script>
/* Ø¨Ø¯Ø¡ */
function startApp(){
  document.getElementById("welcome").style.display="none";
}

/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map=L.map('map').setView([36.2,37.13],13);
const normal=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
const dark=L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
const traffic=L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png');

let darkOn=false,trafficOn=false;
function toggleDark(){darkOn?map.removeLayer(dark):map.addLayer(dark);darkOn=!darkOn}
function toggleTraffic(){trafficOn?map.removeLayer(traffic):map.addLayer(traffic);trafficOn=!trafficOn}

/* Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
let start=null,end=null,route=null,mode="car";
navigator.geolocation.getCurrentPosition(p=>{
  start=L.latLng(p.coords.latitude,p.coords.longitude);
  map.setView(start,15);
});

/* Ø¨Ø­Ø« */
const search=document.getElementById("search");
const sug=document.getElementById("sug");
search.oninput=()=>{
  if(search.value.length<3){sug.style.display="none";return;}
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${search.value}`)
  .then(r=>r.json()).then(d=>{
    sug.innerHTML="";
    d.slice(0,5).forEach(p=>{
      const div=document.createElement("div");
      div.innerText=p.display_name;
      div.onclick=()=>select(p);
      sug.appendChild(div);
    });
    sug.style.display="block";
  });
};

function select(p){
  sug.style.display="none";
  map.setView([p.lat,p.lon],15);
  if(!start) start=L.latLng(p.lat,p.lon);
  else{end=L.latLng(p.lat,p.lon);draw();}
}

/* Ù…Ù„Ø§Ø­Ø© */
function setMode(m){mode=m;if(start&&end)draw();}
function draw(){
  if(route) map.removeControl(route);
  route=L.Routing.control({
    waypoints:[start,end],
    router:L.Routing.osrmv1({profile:mode}),
    addWaypoints:false
  }).addTo(map);
}
function clearRoute(){if(route)map.removeControl(route);route=null;start=null;end=null}

/* Ø­ÙØ¸ */
function savePlace(){
  if(start) localStorage.setItem("saved",JSON.stringify(start));
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ â­");
}
function setHome(){
  if(start) localStorage.setItem("home",JSON.stringify(start));
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØª ğŸ ");
}
function goHome(){
  const h=localStorage.getItem("home");
  if(h){
    const l=JSON.parse(h);
    map.setView([l.lat,l.lng],16);
  }
}

/* Ù…Ø´Ø§Ø±ÙƒØ© */
function share(){
  if(!start)return;
  const url=`${location.origin}${location.pathname}?lat=${start.lat}&lng=${start.lng}`;
  navigator.clipboard.writeText(url);
  alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ“¤");
}

/* Ø³Ù‡Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡ */
if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientation",e=>{
    if(e.alpha)
      document.getElementById("compass").style.transform=`rotate(${e.alpha}deg)`;
  });
}
</script>

</body>
</html>

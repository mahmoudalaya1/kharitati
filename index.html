<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ø¹ÙŠØ§ - Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root { --blue: #4285F4; --red: #EA4335; --gray: #5f6368; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; font-family: sans-serif; }
        
        /* Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙƒØ®Ù„ÙÙŠØ© */
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ù…Ø«Ù„ ØµÙˆØ±ØªÙƒ) */
        .top-ui { 
            position: fixed; top: 12px; width: 90%; left: 5%; z-index: 2000; 
            background: white; border-radius: 24px; display: flex; align-items: center;
            padding: 8px 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .top-ui input { border: none; flex: 1; padding: 8px; font-size: 16px; outline: none; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¹Ù„Ù†Ø§ z-index Ø¹Ø§Ù„Ù Ø¬Ø¯Ø§Ù‹) */
        .side-btns { 
            position: fixed; right: 15px; bottom: 120px; z-index: 2000; 
            display: flex; flex-direction: column; gap: 15px; 
        }
        .fab {
            width: 50px; height: 50px; background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3); color: var(--gray);
            cursor: pointer; pointer-events: auto; /* Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ù†Ù‚Ø± */
        }
        .btn-go { background: var(--blue); color: white; }

        /* Ù„ÙˆØ­Ø© Ø§Ø³ØªÙƒØ´Ù Ø­ÙˆÙ„Ùƒ (Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± ÙÙŠ ØµÙˆØ±ØªÙƒ) */
        .bottom-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            z-index: 2100; border-radius: 20px 20px 0 0; padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center;
        }
        .sheet-handle { width: 40px; height: 5px; background: #e0e0e0; border-radius: 5px; margin: 0 auto 15px; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn-opt { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 10px; background: white; cursor: pointer; }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© */
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="top-ui">
    <i class="fas fa-bars" onclick="alert('Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹')"></i>
    <input type="text" placeholder="Ø§Ù„Ø¨Ø­Ø« Ù‡Ù†Ø§ (Ù…Ø·Ø¹Ù…ØŒ ÙˆÙ‚ÙˆØ¯...)">
    <i class="fas fa-microphone" style="color: var(--blue);"></i>
</div>

<div class="side-btns">
    <div class="fab" onclick="changeMapLayer()" title="Ø·Ø¨Ù‚Ø§Øª"><i class="fas fa-layer-group"></i></div>
    <div class="fab" onclick="alert('Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø§Ù„Ø¢Ù†')" title="Ù…Ø±ÙˆØ±"><i class="fas fa-traffic-light"></i></div>
    <div class="fab" onclick="getMyLocation()" title="Ù…ÙˆÙ‚Ø¹ÙŠ"><i class="fas fa-location-crosshairs"></i></div>
    <div class="fab btn-go" onclick="startNavigation()" title="Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù„Ø§Ø­Ø©"><i class="fas fa-directions"></i></div>
</div>

<div class="bottom-sheet">
    <div class="sheet-handle"></div>
    <h3 style="margin:0">Ø§Ø³ØªÙƒØ´Ù Ø­ÙˆÙ„Ùƒ</h3>
    <p style="color:#70757a; font-size: 14px;">Ø­Ø¯Ø¯ ÙˆØ¬Ù‡Ø© Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø­ÙŠØ©</p>
    <div class="btn-group">
        <button class="btn-opt" onclick="alert('Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ø·Ø§Øª ÙˆÙ‚ÙˆØ¯')">â›½ Ù…Ø­Ø·Ø©</button>
        <button class="btn-opt" onclick="alert('Ø¨Ø­Ø« Ø¹Ù† Ù…Ø·Ø§Ø¹Ù…')">ğŸ´ Ù…Ø·Ø¹Ù…</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    var map = L.map('map', { zoomControl: false }).setView([24.7136, 46.6753], 13);
    
    // Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ ÙˆØ´ÙˆØ§Ø±Ø¹)
    var streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var satLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    // 2. Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
    function changeMapLayer() {
        if (map.hasLayer(streetLayer)) {
            map.removeLayer(streetLayer);
            satLayer.addTo(map);
        } else {
            map.removeLayer(satLayer);
            streetLayer.addTo(map);
        }
    }

async function findNearby(type) {
    const center = map.getCenter(); // Ø§Ù„Ø¨Ø­Ø« Ø­ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø®Ø±ÙŠØ·Ø©
    const category = type === 'gas' ? 'fuel' : 'restaurant';
    
    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${category}&lat=${center.lat}&lon=${center.lng}&bounded=1`);
    const results = await response.json();
    
    results.forEach(place => {
        L.marker([place.lat, place.lon]).addTo(map).bindPopup(place.display_name);
    });
    alert(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù‚Ø±Ø¨ ${type} Ø­ÙˆÙ„Ùƒ`);
}
    
    // 3. Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚)
    var userMarker;
    function getMyLocation() {
        map.locate({setView: true, maxZoom: 16});
    }

    map.on('locationfound', function(e) {
        if (userMarker) map.removeLayer(userMarker);
        // Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        userMarker = L.circleMarker(e.latlng, {
            radius: 8, color: 'white', fillColor: '#4285F4', fillOpacity: 1, weight: 3
        }).addTo(map);
        console.log("ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­");
    });

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Nominatim (Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆØ­Ù‚ÙŠÙ‚ÙŠØ©)
const searchInput = document.querySelector('.top-ui input');

searchInput.addEventListener('input', async (e) => {
    const query = e.target.value;
    if (query.length < 3) return; // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© 3 Ø­Ø±ÙˆÙ

    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=5`);
    const results = await response.json();
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù‡Ù†Ø§)
    console.log("Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«:", results); 
});

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø®ØªØ§Ø±
function goToPlace(lat, lon, name) {
    map.setView([lat, lon], 17); // Ø²ÙˆÙˆÙ… Ø¹Ø§Ù„ÙŠ Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø®ØªÙˆØ±
    
    // ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø§Ù„Ø£Ø­Ù…Ø± ğŸ“ [ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª]
    L.marker([lat, lon], {
        icon: L.divIcon({
            html: '<i class="fas fa-map-marker-alt" style="color:#EA4335; font-size:30px;"></i>',
            className: 'dummy'
        })
    }).addTo(map).bindPopup(name).openPopup();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†
    document.querySelector('.bottom-sheet h3').innerText = name;
}

    map.on('locationerror', function(e) {
        alert("ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…ÙˆÙ‚Ø¹Ùƒ: ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ GPS ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… HTTPS");
    });

    // 4. Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø©
    function startNavigation() {
        alert("Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ø­ÙŠØ© Ù„Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©...");
        // Ù‡Ù†Ø§ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ OSRM Ù„Ù„Ø±Ø¨Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    }

    // Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = function() {
        console.log("Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…");
        getMyLocation(); 
    };
</script>

</body>
</html>


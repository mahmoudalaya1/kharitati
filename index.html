<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Kharitati</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html,body{
  margin:0;
  height:100%;
  font-family:Arial, sans-serif;
  background:#f5f6f7;
}
#map{height:100%}

/* ===== AppBar ===== */
#appBar{
  position:fixed;
  top:0;left:0;right:0;
  height:56px;
  background:#1f2a44;
  color:#fff;
  display:flex;
  align-items:center;
  padding:0 16px;
  z-index:3000;
}
#title{
  flex:1;
  font-size:16px;
  font-weight:bold;
}
#menu{
  font-size:22px;
}

/* ===== Search ===== */
#searchBox{
  position:fixed;
  top:68px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  z-index:3000;
}
#searchInput{
  width:100%;
  padding:14px 18px;
  border:none;
  border-radius:18px;
  font-size:15px;
  box-shadow:0 8px 24px rgba(0,0,0,.25);
  outline:none;
}

/* ===== Floating Buttons ===== */
#actions{
  position:fixed;
  right:14px;
  bottom:120px;
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:3000;
}
.action-btn{
  width:52px;
  height:52px;
  border-radius:50%;
  border:none;
  background:#fff;
  font-size:22px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
  cursor:pointer;
}

/* ===== Bottom Sheet ===== */
#sheet{
  position:fixed;
  left:0;right:0;bottom:0;
  background:#fff;
  border-radius:26px 26px 0 0;
  padding:16px 20px 28px;
  box-shadow:0 -8px 28px rgba(0,0,0,.25);
  z-index:2500;
}
#handle{
  width:46px;height:5px;
  background:#ccc;
  border-radius:4px;
  margin:0 auto 12px;
}
#sheetTitle{
  font-size:16px;
  font-weight:bold;
}
#sheetText{
  margin-top:6px;
  font-size:14px;
  color:#666;
}

/* ===== User Marker ===== */
.user-dot{
  width:18px;height:18px;
  background:#2d7cff;
  border-radius:50%;
  border:3px solid #fff;
  box-shadow:0 0 0 8px rgba(45,124,255,.25);
}

/* ===== Weather ===== */
#weather{
  position:fixed;
  top:140px;
  left:50%;
  transform:translateX(-50%);
  background:#fff;
  padding:16px 20px;
  border-radius:18px;
  box-shadow:0 8px 26px rgba(0,0,0,.3);
  display:none;
  z-index:4000;
  font-size:14px;
}
</style>
</head>

<body>

<div id="appBar">
  <div id="title">MAHMOUD ALAYA</div>
  <div id="menu">â‹®</div>
</div>

<div id="searchBox">
  <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
</div>

<div id="actions">
  <button class="action-btn" id="loc">ğŸ“</button>
  <button class="action-btn" id="nav">â–¶ï¸</button>
  <button class="action-btn" id="share">ğŸ“¤</button>
  <button class="action-btn" id="weatherBtn">ğŸŒ¦ï¸</button>
  <button class="action-btn" id="terrainBtn">â›°ï¸</button>
  <button class="action-btn" id="tour">ğŸ§­</button>
</div>

<div id="weather"></div>

<div id="sheet">
  <div id="handle"></div>
  <div id="sheetTitle">Ø¬Ø§Ù‡Ø²</div>
  <div id="sheetText">Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø«Ù… Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø©</div>
</div>

<div id="map"></div>

<script>
/* ===== Map Layers ===== */
const streetLayer = L.tileLayer(
 "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
 {maxZoom:19}
);

const terrainLayer = L.tileLayer(
 "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",
 {maxZoom:17}
);

const satelliteLayer = L.tileLayer(
 "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
 {maxZoom:19}
);

/* ===== Map Init ===== */
const map = L.map("map",{zoomControl:true})
.setView([36.2021,37.1343],13);

streetLayer.addTo(map);
let currentLayer="street";

/* ===== State ===== */
let userMarker,start,end,route;

/* ===== Locate ===== */
loc.onclick=()=>map.locate({setView:true,maxZoom:16});

map.on("locationfound",e=>{
  start=[e.latlng.lat,e.latlng.lng];
  if(userMarker) map.removeLayer(userMarker);
  userMarker=L.marker(e.latlng,{
    icon:L.divIcon({
      className:"",
      html:'<div class="user-dot"></div>',
      iconSize:[18,18]
    })
  }).addTo(map);
  sheetText.innerText="ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ";
});

/* ===== Destination ===== */
map.on("click",e=>{
  end=[e.latlng.lat,e.latlng.lng];
  sheetText.innerText="ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¬Ù‡Ø©";
});

/* ===== Navigation ===== */
nav.onclick=()=>{
  if(!start||!end){alert("Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ ÙˆØ§Ù„ÙˆØ¬Ù‡Ø©");return;}
  fetch(`https://router.project-osrm.org/route/v1/foot/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`)
  .then(r=>r.json())
  .then(d=>{
    if(route) map.removeLayer(route);
    route=L.geoJSON(d.routes[0].geometry,{
      style:{color:"#2d7cff",weight:6}
    }).addTo(map);
    sheetTitle.innerText="Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø¨Ø¯Ø£Øª";
    sheetText.innerText="Ø§ØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø±";
  });
};

/* ===== Search ===== */
searchInput.onkeydown=e=>{
  if(e.key==="Enter"){
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${searchInput.value}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d.length) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬");
      map.setView([d[0].lat,d[0].lon],16);
    });
  }
};

/* ===== Share ===== */
share.onclick=()=>{
  if(!start) return alert("Ø´ØºÙ‘Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
  navigator.clipboard.writeText(
    `https://maps.google.com/?q=${start[0]},${start[1]}`
  );
  alert("ØªÙ… Ù†Ø³Ø® Ù…ÙˆÙ‚Ø¹Ùƒ");
};

/* ===== Weather ===== */
weatherBtn.onclick=()=>{
  if(!start) return alert("Ø´ØºÙ‘Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
  fetch(`https://api.open-meteo.com/v1/forecast?latitude=${start[0]}&longitude=${start[1]}&current_weather=true`)
  .then(r=>r.json())
  .then(d=>{
    weather.innerHTML=`
      <b>Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¢Ù†</b><br><br>
      ğŸŒ¡ï¸ ${d.current_weather.temperature}Â°C<br>
      ğŸ’¨ ${d.current_weather.windspeed} ÙƒÙ…/Ø³
    `;
    weather.style.display=
      weather.style.display==="block"?"none":"block";
  });
};

/* ===== Terrain / Satellite Toggle ===== */
terrainBtn.onclick=()=>{
  if(currentLayer==="street"){
    map.removeLayer(streetLayer);
    terrainLayer.addTo(map);
    currentLayer="terrain";
    sheetTitle.innerText="â›°ï¸ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¶Ø§Ø±ÙŠØ³";
  }
  else if(currentLayer==="terrain"){
    map.removeLayer(terrainLayer);
    satelliteLayer.addTo(map);
    currentLayer="satellite";
    sheetTitle.innerText="ğŸ›°ï¸ Ø§Ù„Ù‚Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ";
  }
  else{
    map.removeLayer(satelliteLayer);
    streetLayer.addTo(map);
    currentLayer="street";
    sheetTitle.innerText="ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©";
  }
};

/* ===== Virtual Tour ===== */
tour.onclick=()=>{
  const c=map.getCenter();
  window.open(`https://kartaview.org/map/@${c.lat},${c.lng},18z`);
};
</script>

</body>
</html>

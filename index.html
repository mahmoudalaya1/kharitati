<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#2c2c2c;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:300px;
  text-align:center;
}
input{
  width:100%;
  padding:10px;
  margin:6px 0;
}
button{
  width:100%;
  padding:10px;
  margin-top:6px;
  background:#1976d2;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button.secondary{
  background:#555;
}
.msg{
  margin-top:10px;
  color:red;
  font-size:14px;
}
</style>
</head>

<body>

<div class="box">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>

  <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… (Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨)">
  <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
  <button class="secondary" onclick="resetPassword()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</button>

  <div id="msg" class="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ðŸ”¥ Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
  authDomain: "kharitati-5cb37.firebaseapp.com",
  projectId: "kharitati-5cb37",
  storageBucket: "kharitati-5cb37.firebasestorage.app",
  messagingSenderId: "296218682746",
  appId: "1:296218682746:web:650a1161841ea510eea2c3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const msg = document.getElementById("msg");

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
window.login = async () => {
  msg.innerText="";
  try{
    await signInWithEmailAndPassword(
      auth,
      email.value.trim(),
      password.value
    );
    alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
  }catch(e){
    msg.innerText = e.message;
  }
};

/* Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ */
window.register = async () => {
  msg.innerText="";
  if(!name.value || !email.value || !password.value){
    msg.innerText="Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
    return;
  }

  try{
    const cred = await createUserWithEmailAndPassword(
      auth,
      email.value.trim(),
      password.value
    );

    await setDoc(doc(db,"users",cred.user.uid),{
      name: name.value,
      email: email.value,
      createdAt: new Date()
    });

    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ðŸŽ‰");
  }catch(e){
    msg.innerText = e.message;
  }
};

/* Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
window.resetPassword = async () => {
  msg.innerText="";
  if(!email.value){
    msg.innerText="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ";
    return;
  }
  try{
    await sendPasswordResetEmail(auth,email.value.trim());
    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ðŸ“©");
  }catch(e){
    msg.innerText = e.message;
  }
};
</script>

</body>
</html>

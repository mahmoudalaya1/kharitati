<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial, sans-serif; }
#map { height:100vh; }

/* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
#loginBox{
  position:fixed;
  inset:0;
  background:#f5f5f5;
  z-index:20000;
  display:flex;
  align-items:center;
  justify-content:center;
}
#loginBox .box{
  background:white;
  padding:20px;
  border-radius:10px;
  width:280px;
  text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
}

/* Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ */
#accountBtn{
  position:fixed;
  top:15px;
  right:15px;
  z-index:9999;
  background:white;
  border:1px solid #ccc;
  border-radius:20px;
  padding:6px 12px;
  cursor:pointer;
  display:none;
}
#accountMenu{
  position:fixed;
  top:55px;
  right:15px;
  z-index:10000;
  background:white;
  border-radius:8px;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
  padding:10px;
  display:none;
  width:200px;
}

/* Ø§Ù„Ø¨Ø­Ø« */
.panel{
  position:fixed;
  top:15px;
  left:15px;
  z-index:1000;
  background:white;
  padding:10px;
  border-radius:8px;
  width:220px;
  box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.panel input{width:100%;padding:6px;margin-bottom:6px}
.panel button{
  width:100%;
  padding:7px;
  background:#2196f3;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox">
  <div class="box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <button onclick="googleLogin()" style="
      width:100%;
      padding:12px;
      background:#4285F4;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:15px;">
      ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
    </button>
  </div>
</div>

<!-- Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ -->
<button id="accountBtn" onclick="toggleAccount()">ğŸ‘¤ Ø­Ø³Ø§Ø¨</button>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ -->
<div id="accountMenu">
  <div id="accountEmail" style="margin-bottom:8px"></div>
  <button onclick="logout()" style="
    width:100%;
    padding:8px;
    background:#f44336;
    color:white;
    border:none;
    border-radius:6px;">
    ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
  </button>
</div>

<!-- Ø§Ù„Ø¨Ø­Ø« -->
<div class="panel">
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <button onclick="searchPlace()">ğŸ” Ø¨Ø­Ø«</button>
  <button style="margin-top:5px" onclick="locateMe()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase + Google Login (Redirect) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithRedirect,
  getRedirectResult,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
  authDomain: "kharitati-5cb37.firebaseapp.com",
  projectId: "kharitati-5cb37",
  storageBucket: "kharitati-5cb37.firebasestorage.app",
  messagingSenderId: "296218682746",
  appId: "1:296218682746:web:650a1161841ea510eea2c3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

window.googleLogin = () => {
  signInWithRedirect(auth, provider);
};

getRedirectResult(auth).catch(()=>{});

window.logout = () => signOut(auth);

onAuthStateChanged(auth, user => {
  if (user) {
    loginBox.style.display = "none";
    accountBtn.style.display = "block";
    accountEmail.innerText = user.email;
  } else {
    loginBox.style.display = "flex";
    accountBtn.style.display = "none";
  }
});

window.toggleAccount = () => {
  accountMenu.style.display =
    accountMenu.style.display === "block" ? "none" : "block";
};
</script>

<script>
/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map = L.map('map').setView([33.5,36.3],6);
let marker=null;

/* Ø§Ù„Ø·Ø¨Ù‚Ø§Øª */
const normal = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
const satellite = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
);
const terrain = L.tileLayer(
  'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png'
);

normal.addTo(map);

L.control.layers(
  {
    "ğŸ—ºï¸ Ø¹Ø§Ø¯ÙŠØ©": normal,
    "ğŸ›°ï¸ Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ": satellite,
    "ğŸ—» ØªØ¶Ø§Ø±ÙŠØ³": terrain
  },
  null,
  { position: "topleft" }
).addTo(map);

function setMarker(lat,lon,text){
  if(marker) map.removeLayer(marker);
  marker = L.marker([lat,lon]).addTo(map).bindPopup(text).openPopup();
}

function searchPlace(){
  if(!search.value) return;
  fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(search.value)}`)
  .then(r=>r.json())
  .then(d=>{
    if(!d.length) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ±");
    setMarker(d[0].lat,d[0].lon,d[0].display_name);
    map.setView([d[0].lat,d[0].lon],15);
  });
}

function locateMe(){
  navigator.geolocation.getCurrentPosition(p=>{
    setMarker(p.coords.latitude,p.coords.longitude,"ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ");
    map.setView([p.coords.latitude,p.coords.longitude],17);
  });
}
</script>

</body>
</html>

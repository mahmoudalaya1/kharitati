<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Google Maps Style Navigation</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        :root { --google-green: #0d652d; --google-blue: #1a73e8; --dark-bg: #111111; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; font-family: 'Roboto', sans-serif; overflow: hidden; background: #000; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; filter: brightness(0.8) contrast(1.2); }

        /* شريط التوجيه العلوي الأنيق (مثل الصورة تماماً) */
        .navigation-header {
            position: fixed; top: 10px; width: 94%; left: 3%; z-index: 3000;
            background: var(--google-green); color: white; border-radius: 16px;
            padding: 15px; display: none; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .navigation-header .instruction { flex: 1; font-size: 22px; font-weight: bold; text-align: right; }
        .navigation-header .turn-icon { font-size: 30px; margin-left: 15px; }

        /* اللوحة السفلية السوداء الاحترافية */
        .navigation-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 3000;
            background: var(--dark-bg); color: white; padding: 15px 20px 30px 20px;
            border-top: 1px solid #333; display: none; grid-template-columns: 1fr 1fr 1fr;
            align-items: center; border-radius: 20px 20px 0 0;
        }
        .stat-item { text-align: center; }
        .time-left { color: #f28b82; font-size: 24px; font-weight: bold; }
        .dist-left { color: #bdc1c6; font-size: 16px; }
        .arrival-time { color: #bdc1c6; font-size: 16px; }
        .close-nav { background: #333; border: 1px solid #555; color: white; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; }

        /* واجهة الاختيار والبحث */
        .top-search { position: fixed; top: 15px; width: 90%; left: 5%; z-index: 2000; background: white; border-radius: 30px; padding: 10px 20px; display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .top-search input { border: none; flex: 1; outline: none; font-size: 16px; margin-right: 10px; }

        .start-ui { position: fixed; bottom: 20px; left: 5%; width: 90%; z-index: 2000; }
        .btn-start-trip { width: 100%; background: var(--google-blue); color: white; border: none; padding: 16px; border-radius: 15px; font-size: 18px; font-weight: bold; display: none; box-shadow: 0 4px 15px rgba(26,115,232,0.4); }

        /* الدائرة الزرقاء لموقعك (المضيئة) */
        .user-location-icon { background: rgba(26, 115, 232, 0.2); border: 2px solid white; border-radius: 50%; box-shadow: 0 0 15px #1a73e8; }
        .user-location-inner { width: 14px; height: 14px; background: #1a73e8; border: 2px solid white; border-radius: 50%; margin: 3px; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="navigation-header" id="navHeader">
    <div class="instruction" id="nextStep">اتجه نحو الشمال</div>
    <div class="turn-icon"><i class="fas fa-arrow-up"></i></div>
</div>

<div class="top-search" id="searchBar">
    <i class="fas fa-search" style="color:#777"></i>
    <input type="text" placeholder="ابحث أو اضغط على الخريطة..." id="target">
</div>

<div class="start-ui">
    <button class="btn-start-trip" id="startBtn" onclick="activateNavigationMode()">بدء المشوار ▶️</button>
</div>

<div class="navigation-footer" id="navFooter">
    <div class="close-nav" onclick="location.reload()"><i class="fas fa-times"></i></div>
    <div class="stat-item">
        <div class="time-left" id="timeLeft">12 د</div>
        <div class="dist-left" id="distLeft">2.5 كم • 6:32 م</div>
    </div>
    <div class="stat-item">
        <div style="font-size: 12px; color: #777;">كم/س</div>
        <div style="font-size: 20px; font-weight: bold;" id="speed">0</div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
    var map = L.map('map', { zoomControl: false }).setView([41.0082, 28.9784], 15);
    
    // استخدام خريطة داكنة لتناسب "الأناقة" المطلوبة
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    var userMarker, destMarker, routeControl;

    // تفعيل اختيار الموقع بالضغط
    map.on('click', function(e) {
        if(destMarker) map.removeLayer(destMarker);
        destMarker = L.marker(e.latlng).addTo(map);
        document.getElementById('startBtn').style.display = 'block';
        if(userMarker) getRoutePreview();
    });

    function getMyLocation() {
        map.locate({setView: true, watch: true, enableHighAccuracy: true});
    }
    getMyLocation();

    map.on('locationfound', function(e) {
        if(!userMarker) {
            var icon = L.divIcon({ className: 'user-location-icon', html: '<div class="user-location-inner"></div>', iconSize: [24, 24] });
            userMarker = L.marker(e.latlng, {icon: icon}).addTo(map);
        } else {
            userMarker.setLatLng(e.latlng);
        }
        if(e.speed) document.getElementById('speed').innerText = Math.round(e.speed * 3.6);
    });

    function getRoutePreview() {
        if(routeControl) map.removeControl(routeControl);
        routeControl = L.Routing.control({
            waypoints: [userMarker.getLatLng(), destMarker.getLatLng()],
            lineOptions: { styles: [{ color: '#1a73e8', weight: 8, opacity: 0.9 }] },
            createMarker: function() { return null; },
            show: false
        }).on('routesfound', function(e) {
            var r = e.routes[0];
            document.getElementById('timeLeft').innerText = Math.round(r.summary.totalTime / 60) + " د";
            document.getElementById('distLeft').innerText = (r.summary.totalDistance / 1000).toFixed(1) + " كم";
        }).addTo(map);
    }

    // الدخول في "وضع الملاحة الأنيق"
    function activateNavigationMode() {
        document.getElementById('searchBar').style.display = 'none';
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('navHeader').style.display = 'flex';
        document.getElementById('navFooter').style.display = 'grid';
        
        // إمالة الخريطة لتبدو ثلاثية الأبعاد
        map.flyTo(userMarker.getLatLng(), 18, {animate: true, duration: 2});
        
        // تفعيل دوران الخريطة التلقائي (360 درجة)
        window.addEventListener('deviceorientation', (e) => {
            if(e.webkitCompassHeading) {
                map.setBearing(e.webkitCompassHeading);
                document.getElementById('map').style.transform = `rotate(${-e.webkitCompassHeading}deg) perspective(1000px) rotateX(45deg)`;
            }
        });
    }
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial, sans-serif; }
#map { height:100vh; }
/* Ø¥Ø²Ø§Ø­Ø© Ø²Ø± Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¹Ù† Ø§Ù„ÙŠØ³Ø§Ø± */
.leaflet-top.leaflet-left {
  margin-left: 15px;
}

/* Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø­Ø« */
.panel {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 1000;
  background: white;
  padding: 10px;
  border-radius: 8px;
  width: 220px;
  box-shadow: 0 2px 6px rgba(0,0,0,.3);
}
.panel input {
  width:100%;
  padding:6px;
  margin-bottom:6px;
}
.panel button {
  width:100%;
  padding:7px;
  background:#2196f3;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
.ctrl {
  position: fixed;
  right: 10px;
  z-index: 1000;
  padding: 10px 14px;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.save { top: 15px; background:#4caf50; }
.edit { top: 65px; background:#ff9800; }
.del  { top:115px; background:#f44336; }
</style>
</head>

<body>

<div class="panel">
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <button onclick="searchPlace()">ğŸ” Ø¨Ø­Ø«</button>
  <button style="margin-top:5px" onclick="locateMe()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
</div>

<button class="ctrl save" onclick="savePlace()">â­ Ø­ÙØ¸</button>
<button class="ctrl edit" onclick="editPlace()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
<button class="ctrl del" onclick="deletePlace()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== Ø§Ù„Ø®Ø±ÙŠØ·Ø© ===== */
const map = L.map('map').setView([33.5138, 36.2765], 6);
let marker = null;
let selectedLatLng = null;
let editMode = false;

/* ===== Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ===== */
const normalMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
const satelliteMap = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
);
const terrainMap = L.tileLayer(
  'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png'
);
const trafficMap = L.tileLayer(
  'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png'
);

normalMap.addTo(map);

L.control.layers(
  {
    "ğŸ—ºï¸ Ø¹Ø§Ø¯ÙŠØ©": normalMap,
    "ğŸ›°ï¸ Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ": satelliteMap,
    "ğŸ—» ØªØ¶Ø§Ø±ÙŠØ³": terrainMap
  },
  {
    "ğŸš¦ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±": trafficMap
  }
).addTo(map);

/* ===== Ø§Ù„Ø¨Ø­Ø« ===== */
function searchPlace(){
  const q = document.getElementById("search").value;
  if(!q) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†");

  fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d.length) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ±");

      const lat = d[0].lat;
      const lon = d[0].lon;

      map.setView([lat,lon],15);
      setMarker(lat,lon,"ğŸ“ "+d[0].display_name);
    });
}

/* ===== Ù…ÙˆÙ‚Ø¹ÙŠ ===== */
function locateMe(){
  navigator.geolocation.getCurrentPosition(pos=>{
    const {latitude, longitude, accuracy} = pos.coords;
    map.setView([latitude,longitude],17);
    setMarker(latitude,longitude,"ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ<br>Ø§Ù„Ø¯Ù‚Ø©: "+Math.round(accuracy)+"Ù…");
  },()=>alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­"));
}

/* ===== Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ===== */
map.on('click', e=>{
  if(!editMode && marker) return;
  selectedLatLng = e.latlng;
  setMarker(e.latlng.lat, e.latlng.lng, "ğŸ“ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯");
  editMode = false;
});

/* ===== Ø£Ø¯ÙˆØ§Øª ===== */
function setMarker(lat,lon,text){
  if(marker) map.removeLayer(marker);
  marker = L.marker([lat,lon]).addTo(map).bindPopup(text).openPopup();
}

function savePlace(){
  if(!marker) return alert("Ø­Ø¯Ø¯ Ù…ÙƒØ§Ù† Ø£ÙˆÙ„Ø§Ù‹");
  localStorage.setItem("savedPlace", JSON.stringify(marker.getLatLng()));
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
}

function editPlace(){
  if(!marker) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙƒØ§Ù†");
  editMode = true;
  alert("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙƒØ§Ù†");
}

function deletePlace(){
  if(!marker) return;
  map.removeLayer(marker);
  marker = null;
  localStorage.removeItem("savedPlace");
  alert("ØªÙ… Ø§Ù„Ù…Ø³Ø­");
}
</script>

</body>
</html>

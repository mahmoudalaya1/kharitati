<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  body { margin:0; font-family: Arial, sans-serif; }
  #map { height:100vh; }
.panel {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 9999;
  background: white;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,.3);
  width: 220px;
}

  .panel input {
    width:100%;
    padding:6px;
    margin-bottom:6px;
  }
  .panel button {
    width:100%;
    padding:7px;
    background:#2196f3;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
  }
</style>
</head>
<body>

<div class="panel">
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <button onclick="searchPlace()">ğŸ” Ø¨Ø­Ø«</button>
  <button style="margin-top:5px" onclick="locateMe()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
</div>
<button class="btn" style="top:70px; right:10px;" onclick="savePlace()">â­ Ø­ÙØ¸ Ø§Ù„Ù…ÙƒØ§Ù†</button>
<button class="btn-save">â­ Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø±</button>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([33.5138, 36.2765], 6);
  let marker;
let selectedLatLng = null;

map.on('click', function(e) {
  selectedLatLng = e.latlng;

  if (marker) {
    map.removeLayer(marker);
  }

  marker = L.marker(e.latlng)
    .addTo(map)
    .bindPopup("Ù…ÙƒØ§Ù† Ù…Ø­Ø¯Ø¯")
    .openPopup();
});

// Ø®Ø±ÙŠØ·Ø© Ø¹Ø§Ø¯ÙŠØ©
const normalMap = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { attribution: 'Â© OpenStreetMap' }
);

// Ø®Ø±ÙŠØ·Ø© ØªØ¶Ø§Ø±ÙŠØ³
const terrainMap = L.tileLayer(
  'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
  { attribution: 'Â© OpenTopoMap' }
);

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
normalMap.addTo(map);

// Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
const baseMaps = {
  "ğŸ—ºï¸ Ø¹Ø§Ø¯ÙŠØ©": normalMap,
  "ğŸ—» ØªØ¶Ø§Ø±ÙŠØ³": terrainMap
};

L.control.layers(baseMaps, null, {
  position: 'topright'
}).addTo(map);



function locateMe(){
  if (!navigator.geolocation) {
    alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const accuracy = pos.coords.accuracy;

      map.setView([lat, lon], 17);

      if (marker) map.removeLayer(marker);

      marker = L.marker([lat, lon])
        .addTo(map)
        .bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ<br>Ø§Ù„Ø¯Ù‚Ø©: " + Math.round(accuracy) + " Ù…ØªØ±")
        .openPopup();
    },
    () => alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹"),
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}

  function searchPlace(){
    const q = document.getElementById("search").value;
    if(!q) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†");

    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}`)
      .then(res => res.json())
      .then(data => {
        if(data.length === 0){
          alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù†");
          return;
        }
        const lat = data[0].lat;
        const lon = data[0].lon;
        map.setView([lat, lon], 14);
        if(marker) map.removeLayer(marker);
        marker = L.marker([lat, lon]).addTo(map)
          .bindPopup(data[0].display_name)
          .openPopup();
      });
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>خريطتي</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
#loginBox{
  width:320px;margin:80px auto;background:#fff;color:#000;
  padding:20px;border-radius:10px;text-align:center
}
input,button{width:100%;padding:10px;margin:6px 0}
button{background:#1976d2;color:#fff;border:none;border-radius:6px}
#map{display:none;height:100vh;width:100%}
#controls{
  position:absolute;top:10px;left:10px;z-index:5;
  background:#fff;color:#000;padding:10px;border-radius:8px
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h3>تسجيل الدخول</h3>
  <input id="email" placeholder="البريد الإلكتروني">
  <input id="password" type="password" placeholder="كلمة المرور">
  <button onclick="login()">دخول</button>
  <button onclick="register()">إنشاء حساب</button>
  <button onclick="resetPassword()">نسيت كلمة المرور؟</button>
  <div id="msg" style="color:red"></div>
</div>

<!-- MAP -->
<div id="map"></div>

<div id="controls" style="display:none">
  <input id="search" placeholder="بحث مكان...">
  <button onclick="searchPlace()">بحث</button>
  <button onclick="toggleTerrain()">تضاريس</button>
  <button onclick="rotateMap()">تدوير</button>
  <button onclick="toggleStreet()">Street View</button>
  <button onclick="logout()">تسجيل خروج</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signOut,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
  authDomain: "kharitati-5cb37.firebaseapp.com",
  projectId: "kharitati-5cb37"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const msg = document.getElementById("msg");

window.login = async()=>{
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){msg.innerText=e.message}
};

window.register = async()=>{
  try{
    await createUserWithEmailAndPassword(auth,email.value,password.value);
    alert("تم إنشاء الحساب");
  }catch(e){msg.innerText=e.message}
};

window.resetPassword = async()=>{
  await sendPasswordResetEmail(auth,email.value);
  alert("تم إرسال رابط الاستعادة");
};

window.logout = ()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  if(user){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("map").style.display="block";
    document.getElementById("controls").style.display="block";
    initMap();
  }else{
    document.getElementById("loginBox").style.display="block";
    document.getElementById("map").style.display="none";
    document.getElementById("controls").style.display="none";
  }
});
</script>

<!-- Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY&libraries=places"></script>
<script>
let map, terrain=false, street=false, panorama;

function initMap(){
  map=new google.maps.Map(document.getElementById("map"),{
    center:{lat:36.2021,lng:37.1343},
    zoom:14,
    mapTypeId:"roadmap"
  });
  panorama = map.getStreetView();
}

function searchPlace(){
  const service=new google.maps.places.PlacesService(map);
  service.textSearch({query:search.value},(res,status)=>{
    if(status==="OK"){
      map.setCenter(res[0].geometry.location);
    }
  });
}

function toggleTerrain(){
  terrain=!terrain;
  map.setMapTypeId(terrain?"terrain":"roadmap");
}

function rotateMap(){
  map.setHeading((map.getHeading()||0)+45);
}

function toggleStreet(){
  street=!street;
  panorama.setPosition(map.getCenter());
  panorama.setVisible(street);
}
</script>

</body>
</html>

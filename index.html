<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;font-family:Arial}
#map{height:100vh}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
#authBox{
  position:fixed;inset:0;
  background:#f2f2f2;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.auth{
  background:#fff;
  padding:20px;
  width:300px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
  text-align:center;
}
.auth input{
  width:100%;
  padding:8px;
  margin:6px 0;
}
.auth button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border:none;
  background:#2196f3;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
}
.auth .link{
  margin-top:8px;
  font-size:13px;
  color:#2196f3;
  cursor:pointer;
}

/* Ø§Ù„Ø­Ø³Ø§Ø¨ */
#accountBtn{
  position:fixed;top:15px;right:15px;
  z-index:9000;
  background:#fff;
  border:1px solid #ccc;
  border-radius:20px;
  padding:6px 12px;
  display:none;
}
#accountMenu{
  position:fixed;top:55px;right:15px;
  background:#fff;
  padding:10px;
  border-radius:8px;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
  display:none;
  z-index:9000;
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
<div id="authBox">
  <div class="auth">
    <h3 id="title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>

    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨)">
    <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>

    <div class="link" onclick="resetPassword()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</div>
  </div>
</div>

<button id="accountBtn" onclick="toggleMenu()">ðŸ‘¤ Ø­Ø³Ø§Ø¨</button>
<div id="accountMenu">
  <div id="userEmail"></div>
  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
  getFirestore,
  doc,
  setDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
  authDomain: "kharitati-5cb37.firebaseapp.com",
  projectId: "kharitati-5cb37",
  storageBucket: "kharitati-5cb37.firebasestorage.app",
  messagingSenderId: "296218682746",
  appId: "1:296218682746:web:650a1161841ea510eea2c3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ */
window.register = async () => {
  if(!email.value || !password.value || !name.value){
    alert("Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  try{
    const cred = await createUserWithEmailAndPassword(auth,email.value,password.value);

    await setDoc(doc(db,"users",cred.user.uid),{
      name:name.value,
      email:email.value,
      created:new Date()
    });

    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
  }catch(e){
    alert(e.message);
  }
};

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
window.login = async () => {
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){
    alert(e.message);
  }
};

/* Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
window.resetPassword = async () => {
  if(!email.value){
    alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
    return;
  }
  await sendPasswordResetEmail(auth,email.value);
  alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
};

/* ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ */
window.logout = () => signOut(auth);

window.toggleMenu = () =>{
  accountMenu.style.display =
    accountMenu.style.display==="block"?"none":"block";
};

/* Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
onAuthStateChanged(auth,user=>{
  if(user){
    authBox.style.display="none";
    accountBtn.style.display="block";
    userEmail.innerText=user.email;
  }else{
    authBox.style.display="flex";
    accountBtn.style.display="none";
  }
});
</script>

<script>
/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map=L.map('map').setView([33.5,36.3],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);
</script>

</body>
</html>

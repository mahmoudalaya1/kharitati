<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  body { margin:0; font-family: Arial, sans-serif; }
  #map { height:100vh; }

  .panel {
    position: fixed;
    top: 15px;
    left: 15px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,.3);
    width: 220px;
  }

  .panel input {
    width:100%;
    padding:6px;
    margin-bottom:6px;
  }

  .panel button {
    width:100%;
    padding:7px;
    background:#2196f3;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
  }
</style>
</head>

<body>

<div class="panel">
  <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
  <button onclick="searchPlace()">ğŸ” Ø¨Ø­Ø«</button>
  <button style="margin-top:5px" onclick="locateMe()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ================== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ================== */
const map = L.map('map').setView([33.5138, 36.2765], 6);
let marker;
let selectedLatLng = null;

/* ================== Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ================== */
const normalMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
});

const satelliteMap = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Â© Esri' }
);

const terrainMap = L.tileLayer(
  'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
  { attribution: 'Â© OpenTopoMap' }
);

const trafficMap = L.tileLayer(
  'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',
  { attribution: 'Â© OpenStreetMap Traffic' }
);

/* ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
normalMap.addTo(map);

/* Ø²Ø± ÙˆØ§Ø­Ø¯ Ù„Ù„ØªØ­ÙƒÙ… */
L.control.layers(
  {
    "ğŸ—ºï¸ Ø¹Ø§Ø¯ÙŠØ©": normalMap,
    "ğŸ›°ï¸ Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ": satelliteMap,
    "ğŸ—» ØªØ¶Ø§Ø±ÙŠØ³": terrainMap
  },
  {
    "ğŸš¦ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±": trafficMap
  },
  { position: 'topright' }
).addTo(map);

/* ================== Ø§Ù„Ø¨Ø­Ø« ================== */
function searchPlace() {
  const q = document.getElementById("search").value;
  if (!q) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†");

  fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`)
    .then(res => res.json())
    .then(data => {
      if (!data.length) {
        alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù†");
        return;
      }

      const lat = data[0].lat;
      const lon = data[0].lon;

      map.setView([lat, lon], 15);

      if (marker) map.removeLayer(marker);
      marker = L.marker([lat, lon])
        .addTo(map)
        .bindPopup("ğŸ“ " + data[0].display_name)
        .openPopup();
    });
}

/* ================== ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ================== */
function locateMe(){
  if (!navigator.geolocation) {
    alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const acc = Math.round(pos.coords.accuracy);

    map.setView([lat, lon], 17);

    if (marker) map.removeLayer(marker);
    marker = L.marker([lat, lon])
      .addTo(map)
      .bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ<br>Ø§Ù„Ø¯Ù‚Ø©: " + acc + " Ù…")
      .openPopup();
  });
}

/* ================== Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ================== */
map.on('click', function(e){
  selectedLatLng = e.latlng;
  if (marker) map.removeLayer(marker);

  marker = L.marker(e.latlng)
    .addTo(map)
    .bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯")
    .openPopup();
});
</script>

</body>
</html>

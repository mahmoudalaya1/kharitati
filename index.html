<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
html,body{margin:0;height:100%;font-family:Arial}
#map{height:100%;width:100%}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
#topBar{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:420px;
  background:white;
  border-radius:30px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  padding:8px 12px;
  z-index:1000;
}

#searchRow{
  display:flex;
  gap:8px;
}

#search{
  flex:1;
  border:none;
  outline:none;
  font-size:16px;
}

#searchBtn{
  background:#1976d2;
  color:white;
  border:none;
  border-radius:50%;
  width:38px;
  height:38px;
  cursor:pointer;
}

#suggestions{
  background:white;
  border-radius:12px;
  margin-top:6px;
  display:none;
  max-height:220px;
  overflow:auto;
}

.sug{
  padding:10px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
#controls{
  position:fixed;
  right:10px;
  top:90px;
  z-index:1000;
  display:flex;
  flex-direction:column;
  gap:8px;
}

#controls button{
  border:none;
  border-radius:10px;
  padding:10px;
  background:#1976d2;
  color:white;
  cursor:pointer;
  font-size:14px;
}
</style>
</head>

<body>

<div id="topBar">
  <div id="searchRow">
    <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†">
    <button id="searchBtn">ğŸ”</button>
  </div>
  <div id="suggestions"></div>
</div>

<div id="controls">
  <button onclick="setMode('car')">ğŸš—</button>
  <button onclick="setMode('foot')">ğŸš¶â€â™‚ï¸</button>
  <button onclick="setMode('bike')">ğŸš´</button>
  <button onclick="toggleCompass()">ğŸ§­</button>
  <button onclick="clearRoute()">âŒ</button>
</div>

<div id="map"></div>

<script>
/* Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
const map = L.map('map').setView([36.2,37.13],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

/* Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
navigator.geolocation.getCurrentPosition(pos=>{
  start = L.latLng(pos.coords.latitude,pos.coords.longitude);
  map.setView(start,15);
});

/* Ø§Ù„Ø¨Ø­Ø« */
const searchInput = document.getElementById("search");
const sugBox = document.getElementById("suggestions");

searchInput.addEventListener("input",()=>{
  const q = searchInput.value.trim();
  if(q.length < 3){sugBox.style.display="none";return;}

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}&limit=5`)
    .then(r=>r.json())
    .then(data=>{
      sugBox.innerHTML="";
      data.forEach(p=>{
        const d=document.createElement("div");
        d.className="sug";
        d.innerText=p.display_name;
        d.onclick=()=>selectPlace(p);
        sugBox.appendChild(d);
      });
      sugBox.style.display="block";
    });
});

document.getElementById("searchBtn").onclick=()=>{
  if(searchInput.value.length<3) return;
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${searchInput.value}&limit=1`)
    .then(r=>r.json())
    .then(d=>{ if(d.length) selectPlace(d[0]); });
};

/* Ø§Ù„Ù…Ù„Ø§Ø­Ø© */
let start=null,end=null,routing=null,mode="car";

function selectPlace(p){
  sugBox.style.display="none";
  map.setView([p.lat,p.lon],15);
  if(!start){ start=L.latLng(p.lat,p.lon); }
  else{ end=L.latLng(p.lat,p.lon); drawRoute(); }
}

function setMode(m){
  mode=m;
  if(start && end) drawRoute();
}

function drawRoute(){
  if(routing) map.removeControl(routing);
  routing=L.Routing.control({
    waypoints:[start,end],
    router:L.Routing.osrmv1({profile:mode}),
    addWaypoints:false,
    draggableWaypoints:false
  }).addTo(map);
}

function clearRoute(){
  if(routing) map.removeControl(routing);
  routing=null; start=null; end=null;
}

/* Compass */
let compassOn=false;
function toggleCompass(){
  compassOn=!compassOn;
}

if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientation",e=>{
    if(compassOn && e.alpha){
      map.getContainer().style.transform=`rotate(${-e.alpha}deg)`;
    }
  });
}
</script>

</body>
</html>

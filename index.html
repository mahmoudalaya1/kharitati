<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø®Ø±ÙŠØ·ØªÙŠ - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f0f2f5;
}
#loginBox{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
.box{
  background:white;
  width:300px;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
  text-align:center;
}
input{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border:none;
  border-radius:6px;
  background:#1976d2;
  color:white;
  cursor:pointer;
}
button.secondary{
  background:#555;
}
a{
  display:block;
  margin-top:8px;
  font-size:13px;
  cursor:pointer;
  color:#1976d2;
}
#app{
  display:none;
  padding:20px;
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox">
  <div class="box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>

    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… (Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨)">
    <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <button class="secondary" onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>

    <a onclick="resetPassword()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
  </div>
</div>

<!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<div id="app">
  <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ ðŸ‘‹</h2>
  <p id="userInfo"></p>
  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  onAuthStateChanged,
  signOut,
  updateProfile
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
  authDomain: "kharitati-5cb37.firebaseapp.com",
  projectId: "kharitati-5cb37",
  appId: "1:296218682746:web:650a1161841ea510eea2c3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ */
window.register = async () => {
  const email = emailInput();
  const password = passwordInput();
  const name = document.getElementById("name").value.trim();

  if(!email || !password){
    alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
    return;
  }

  try{
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    if(name){
      await updateProfile(cred.user,{displayName:name});
    }
    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
  }catch(e){
    alert(e.message);
  }
};

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
window.login = async () => {
  try{
    await signInWithEmailAndPassword(auth, emailInput(), passwordInput());
  }catch(e){
    alert(e.message);
  }
};

/* Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
window.resetPassword = async () => {
  const email = emailInput();
  if(!email){
    alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ù‹Ø§");
    return;
  }
  try{
    await sendPasswordResetEmail(auth,email);
    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
  }catch(e){
    alert(e.message);
  }
};

/* ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ */
window.logout = () => signOut(auth);

/* Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬Ù„Ø³Ø© */
onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.style.display="none";
    app.style.display="block";
    userInfo.innerText =
      "Ø§Ù„Ø§Ø³Ù…: " + (user.displayName || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…") +
      "\nØ§Ù„Ø¨Ø±ÙŠØ¯: " + user.email;
  }else{
    loginBox.style.display="flex";
    app.style.display="none";
  }
});

/* Helpers */
function emailInput(){return document.getElementById("email").value.trim();}
function passwordInput(){return document.getElementById("password").value;}
</script>

</body>
</html>

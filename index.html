<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
    authDomain: "kharitati-5cb37.firebaseapp.com",
    projectId: "kharitati-5cb37",
    storageBucket: "kharitati-5cb37.firebasestorage.app",
    messagingSenderId: "296218682746",
    appId: "1:296218682746:web:e097a1279383dd02eea2c3"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
</script>

<!-- Ø£Ø²Ø±Ø§Ø± -->
<button id="googleLogin">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google</button>
<button id="logout" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<script type="module">
  // ðŸ”¹ Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ðŸ”¹ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDr5hql0t0eI0AYi7-_xLZfYpFw8F6vXRA",
    authDomain: "kharitati-5cb37.firebaseapp.com",
    projectId: "kharitati-5cb37",
    storageBucket: "kharitati-5cb37.firebasestorage.app",
    messagingSenderId: "296218682746",
    appId: "1:296218682746:web:e097a1279383dd02eea2c3"
  };

  // ðŸ”¹ Init
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  // ðŸ”¹ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Google
  document.getElementById("googleLogin").onclick = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      await setDoc(doc(db, "users", user.uid), {
        uid: user.uid,
        name: user.displayName,
        email: user.email,
        photoURL: user.photoURL,
        online: true,
        lastSeen: serverTimestamp(),
        createdAt: serverTimestamp()
      }, { merge: true });

      alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
    } catch (e) {
      console.error(e);
      alert("Ø®Ø·Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    }
  };

  // ðŸ”¹ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
  document.getElementById("logout").onclick = async () => {
    await signOut(auth);
  };

  // ðŸ”¹ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("googleLogin").style.display = "none";
      document.getElementById("logout").style.display = "block";
      console.log("Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„:", user.uid);
    } else {
      document.getElementById("googleLogin").style.display = "block";
      document.getElementById("logout").style.display = "none";
    }
  });
</script>
